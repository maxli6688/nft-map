!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("react")):"function"==typeof define&&define.amd?define(["exports","react"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).KvmTileMap={},e.React)}(this,function(e,t){"use strict";var n=Object.defineProperty,r=Object.defineProperties,o=Object.getOwnPropertyDescriptors,i=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable,c=(e,t,r)=>t in e?n(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,u=(e,t)=>{for(var n in t||(t={}))s.call(t,n)&&c(e,n,t[n]);if(i)for(var n of i(t))a.call(t,n)&&c(e,n,t[n]);return e},l=(e,t)=>r(e,o(t)),h=(e,t,n)=>c(e,"symbol"!=typeof t?t+"":t,n);function p(e){const t=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(e)for(const n in e)if("default"!==n){const r=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,r.get?r:{enumerable:!0,get:()=>e[n]})}return t.default=e,Object.freeze(t)}const d=p(t);function f(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var v,m={exports:{}},y={};var g,w,b={};
/**
   * @license React
   * react-jsx-runtime.development.js
   *
   * Copyright (c) Facebook, Inc. and its affiliates.
   *
   * This source code is licensed under the MIT license found in the
   * LICENSE file in the root directory of this source tree.
   */function x(){return g||(g=1,"production"!==process.env.NODE_ENV&&function(){var e=t,n=Symbol.for("react.element"),r=Symbol.for("react.portal"),o=Symbol.for("react.fragment"),i=Symbol.for("react.strict_mode"),s=Symbol.for("react.profiler"),a=Symbol.for("react.provider"),c=Symbol.for("react.context"),u=Symbol.for("react.forward_ref"),l=Symbol.for("react.suspense"),h=Symbol.for("react.suspense_list"),p=Symbol.for("react.memo"),d=Symbol.for("react.lazy"),f=Symbol.for("react.offscreen"),v=Symbol.iterator;var m=e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;function y(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];!function(e,t,n){var r=m.ReactDebugCurrentFrame.getStackAddendum();""!==r&&(t+="%s",n=n.concat([r]));var o=n.map(function(e){return String(e)});o.unshift("Warning: "+t),Function.prototype.apply.call(console[e],console,o)}("error",e,n)}var g;function w(e){return e.displayName||"Context"}function x(e){if(null==e)return null;if("number"==typeof e.tag&&y("Received an unexpected object in getComponentNameFromType(). This is likely a bug in React. Please file an issue."),"function"==typeof e)return e.displayName||e.name||null;if("string"==typeof e)return e;switch(e){case o:return"Fragment";case r:return"Portal";case s:return"Profiler";case i:return"StrictMode";case l:return"Suspense";case h:return"SuspenseList"}if("object"==typeof e)switch(e.$$typeof){case c:return w(e)+".Consumer";case a:return w(e._context)+".Provider";case u:return function(e,t,n){var r=e.displayName;if(r)return r;var o=t.displayName||t.name||"";return""!==o?n+"("+o+")":n}(e,e.render,"ForwardRef");case p:var t=e.displayName||null;return null!==t?t:x(e.type)||"Memo";case d:var n=e,f=n._payload,v=n._init;try{return x(v(f))}catch(m){return null}}return null}g=Symbol.for("react.module.reference");var _,S,E,M,L,z,k,C=Object.assign,P=0;function O(){}O.__reactDisabledLog=!0;var T,j=m.ReactCurrentDispatcher;function D(e,t,n){if(void 0===T)try{throw Error()}catch(o){var r=o.stack.trim().match(/\n( *(at )?)/);T=r&&r[1]||""}return"\n"+T+e}var R,N=!1,Y="function"==typeof WeakMap?WeakMap:Map;function $(e,t){if(!e||N)return"";var n,r=R.get(e);if(void 0!==r)return r;N=!0;var o,i=Error.prepareStackTrace;Error.prepareStackTrace=void 0,o=j.current,j.current=null,function(){if(0===P){_=console.log,S=console.info,E=console.warn,M=console.error,L=console.group,z=console.groupCollapsed,k=console.groupEnd;var e={configurable:!0,enumerable:!0,value:O,writable:!0};Object.defineProperties(console,{info:e,log:e,warn:e,error:e,group:e,groupCollapsed:e,groupEnd:e})}P++}();try{if(t){var s=function(){throw Error()};if(Object.defineProperty(s.prototype,"props",{set:function(){throw Error()}}),"object"==typeof Reflect&&Reflect.construct){try{Reflect.construct(s,[])}catch(f){n=f}Reflect.construct(e,[],s)}else{try{s.call()}catch(f){n=f}e.call(s.prototype)}}else{try{throw Error()}catch(f){n=f}e()}}catch(v){if(v&&n&&"string"==typeof v.stack){for(var a=v.stack.split("\n"),c=n.stack.split("\n"),u=a.length-1,l=c.length-1;u>=1&&l>=0&&a[u]!==c[l];)l--;for(;u>=1&&l>=0;u--,l--)if(a[u]!==c[l]){if(1!==u||1!==l)do{if(u--,--l<0||a[u]!==c[l]){var h="\n"+a[u].replace(" at new "," at ");return e.displayName&&h.includes("<anonymous>")&&(h=h.replace("<anonymous>",e.displayName)),"function"==typeof e&&R.set(e,h),h}}while(u>=1&&l>=0);break}}}finally{N=!1,j.current=o,function(){if(0===--P){var e={configurable:!0,enumerable:!0,writable:!0};Object.defineProperties(console,{log:C({},e,{value:_}),info:C({},e,{value:S}),warn:C({},e,{value:E}),error:C({},e,{value:M}),group:C({},e,{value:L}),groupCollapsed:C({},e,{value:z}),groupEnd:C({},e,{value:k})})}P<0&&y("disabledDepth fell below zero. This is a bug in React. Please file an issue.")}(),Error.prepareStackTrace=i}var p=e?e.displayName||e.name:"",d=p?D(p):"";return"function"==typeof e&&R.set(e,d),d}function X(e,t,n){if(null==e)return"";if("function"==typeof e)return $(e,!(!(r=e.prototype)||!r.isReactComponent));var r;if("string"==typeof e)return D(e);switch(e){case l:return D("Suspense");case h:return D("SuspenseList")}if("object"==typeof e)switch(e.$$typeof){case u:return $(e.render,!1);case p:return X(e.type,t,n);case d:var o=e,i=o._payload,s=o._init;try{return X(s(i),t,n)}catch(a){}}return""}R=new Y;var F=Object.prototype.hasOwnProperty,U={},I=m.ReactDebugCurrentFrame;function A(e){if(e){var t=e._owner,n=X(e.type,e._source,t?t.type:null);I.setExtraStackFrame(n)}else I.setExtraStackFrame(null)}var W=Array.isArray;function B(e){return W(e)}function q(e){return""+e}function H(e){if(function(e){try{return q(e),!1}catch(t){return!0}}(e))return y("The provided key is an unsupported type %s. This value must be coerced to a string before before using it here.",function(e){return"function"==typeof Symbol&&Symbol.toStringTag&&e[Symbol.toStringTag]||e.constructor.name||"Object"}(e)),q(e)}var V,Z,K=m.ReactCurrentOwner,J={key:!0,ref:!0,__self:!0,__source:!0};function G(e,t,r,o,i){var s,a={},c=null,u=null;for(s in void 0!==r&&(H(r),c=""+r),function(e){if(F.call(e,"key")){var t=Object.getOwnPropertyDescriptor(e,"key").get;if(t&&t.isReactWarning)return!1}return void 0!==e.key}(t)&&(H(t.key),c=""+t.key),function(e){if(F.call(e,"ref")){var t=Object.getOwnPropertyDescriptor(e,"ref").get;if(t&&t.isReactWarning)return!1}return void 0!==e.ref}(t)&&(u=t.ref,function(e){"string"==typeof e.ref&&K.current}(t)),t)F.call(t,s)&&!J.hasOwnProperty(s)&&(a[s]=t[s]);if(e&&e.defaultProps){var l=e.defaultProps;for(s in l)void 0===a[s]&&(a[s]=l[s])}if(c||u){var h="function"==typeof e?e.displayName||e.name||"Unknown":e;c&&function(e,t){var n=function(){V||(V=!0,y("%s: `key` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://reactjs.org/link/special-props)",t))};n.isReactWarning=!0,Object.defineProperty(e,"key",{get:n,configurable:!0})}(a,h),u&&function(e,t){var n=function(){Z||(Z=!0,y("%s: `ref` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://reactjs.org/link/special-props)",t))};n.isReactWarning=!0,Object.defineProperty(e,"ref",{get:n,configurable:!0})}(a,h)}return function(e,t,r,o,i,s,a){var c={$$typeof:n,type:e,key:t,ref:r,props:a,_owner:s,_store:{}};return Object.defineProperty(c._store,"validated",{configurable:!1,enumerable:!1,writable:!0,value:!1}),Object.defineProperty(c,"_self",{configurable:!1,enumerable:!1,writable:!1,value:o}),Object.defineProperty(c,"_source",{configurable:!1,enumerable:!1,writable:!1,value:i}),Object.freeze&&(Object.freeze(c.props),Object.freeze(c)),c}(e,c,u,i,o,K.current,a)}var Q,ee=m.ReactCurrentOwner,te=m.ReactDebugCurrentFrame;function ne(e){if(e){var t=e._owner,n=X(e.type,e._source,t?t.type:null);te.setExtraStackFrame(n)}else te.setExtraStackFrame(null)}function re(e){return"object"==typeof e&&null!==e&&e.$$typeof===n}function oe(){if(ee.current){var e=x(ee.current.type);if(e)return"\n\nCheck the render method of `"+e+"`."}return""}Q=!1;var ie={};function se(e,t){if(e._store&&!e._store.validated&&null==e.key){e._store.validated=!0;var n=function(e){var t=oe();if(!t){var n="string"==typeof e?e:e.displayName||e.name;n&&(t="\n\nCheck the top-level render call using <"+n+">.")}return t}(t);if(!ie[n]){ie[n]=!0;var r="";e&&e._owner&&e._owner!==ee.current&&(r=" It was passed a child from "+x(e._owner.type)+"."),ne(e),y('Each child in a list should have a unique "key" prop.%s%s See https://reactjs.org/link/warning-keys for more information.',n,r),ne(null)}}}function ae(e,t){if("object"==typeof e)if(B(e))for(var n=0;n<e.length;n++){var r=e[n];re(r)&&se(r,t)}else if(re(e))e._store&&(e._store.validated=!0);else if(e){var o=function(e){if(null===e||"object"!=typeof e)return null;var t=v&&e[v]||e["@@iterator"];return"function"==typeof t?t:null}(e);if("function"==typeof o&&o!==e.entries)for(var i,s=o.call(e);!(i=s.next()).done;)re(i.value)&&se(i.value,t)}}function ce(e){var t,n=e.type;if(null!=n&&"string"!=typeof n){if("function"==typeof n)t=n.propTypes;else{if("object"!=typeof n||n.$$typeof!==u&&n.$$typeof!==p)return;t=n.propTypes}if(t){var r=x(n);!function(e,t,n,r,o){var i=Function.call.bind(F);for(var s in e)if(i(e,s)){var a=void 0;try{if("function"!=typeof e[s]){var c=Error((r||"React class")+": "+n+" type `"+s+"` is invalid; it must be a function, usually from the `prop-types` package, but received `"+typeof e[s]+"`.This often happens because of typos such as `PropTypes.function` instead of `PropTypes.func`.");throw c.name="Invariant Violation",c}a=e[s](t,s,r,n,null,"SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED")}catch(u){a=u}!a||a instanceof Error||(A(o),y("%s: type specification of %s `%s` is invalid; the type checker function must return `null` or an `Error` but returned a %s. You may have forgotten to pass an argument to the type checker creator (arrayOf, instanceOf, objectOf, oneOf, oneOfType, and shape all require an argument).",r||"React class",n,s,typeof a),A(null)),a instanceof Error&&!(a.message in U)&&(U[a.message]=!0,A(o),y("Failed %s type: %s",n,a.message),A(null))}}(t,e.props,"prop",r,e)}else if(void 0!==n.PropTypes&&!Q){Q=!0,y("Component %s declared `PropTypes` instead of `propTypes`. Did you misspell the property assignment?",x(n)||"Unknown")}"function"!=typeof n.getDefaultProps||n.getDefaultProps.isReactClassApproved||y("getDefaultProps is only used on classic React.createClass definitions. Use a static property named `defaultProps` instead.")}}var ue={};function le(e,t,r,v,m,w){var b=function(e){return"string"==typeof e||"function"==typeof e||e===o||e===s||e===i||e===l||e===h||e===f||"object"==typeof e&&null!==e&&(e.$$typeof===d||e.$$typeof===p||e.$$typeof===a||e.$$typeof===c||e.$$typeof===u||e.$$typeof===g||void 0!==e.getModuleId)}(e);if(!b){var _="";(void 0===e||"object"==typeof e&&null!==e&&0===Object.keys(e).length)&&(_+=" You likely forgot to export your component from the file it's defined in, or you might have mixed up default and named imports.");var S;_+=oe(),null===e?S="null":B(e)?S="array":void 0!==e&&e.$$typeof===n?(S="<"+(x(e.type)||"Unknown")+" />",_=" Did you accidentally export a JSX literal instead of a component?"):S=typeof e,y("React.jsx: type is invalid -- expected a string (for built-in components) or a class/function (for composite components) but got: %s.%s",S,_)}var E=G(e,t,r,m,w);if(null==E)return E;if(b){var M=t.children;if(void 0!==M)if(v)if(B(M)){for(var L=0;L<M.length;L++)ae(M[L],e);Object.freeze&&Object.freeze(M)}else y("React.jsx: Static children should always be an array. You are likely explicitly calling React.jsxs or React.jsxDEV. Use the Babel transform instead.");else ae(M,e)}if(F.call(t,"key")){var z=x(e),k=Object.keys(t).filter(function(e){return"key"!==e}),C=k.length>0?"{key: someKey, "+k.join(": ..., ")+": ...}":"{key: someKey}";if(!ue[z+C])y('A props object containing a "key" prop is being spread into JSX:\n  let props = %s;\n  <%s {...props} />\nReact keys must be passed directly to JSX without using spread:\n  let props = %s;\n  <%s key={someKey} {...props} />',C,z,k.length>0?"{"+k.join(": ..., ")+": ...}":"{}",z),ue[z+C]=!0}return e===o?function(e){for(var t=Object.keys(e.props),n=0;n<t.length;n++){var r=t[n];if("children"!==r&&"key"!==r){ne(e),y("Invalid prop `%s` supplied to `React.Fragment`. React.Fragment can only have `key` and `children` props.",r),ne(null);break}}null!==e.ref&&(ne(e),y("Invalid attribute `ref` supplied to `React.Fragment`."),ne(null))}(E):ce(E),E}var he=function(e,t,n){return le(e,t,n,!1)},pe=function(e,t,n){return le(e,t,n,!0)};b.Fragment=o,b.jsx=he,b.jsxs=pe}()),b}var _=(w||(w=1,"production"===process.env.NODE_ENV?m.exports=function(){if(v)return y;v=1;var e=t,n=Symbol.for("react.element"),r=Symbol.for("react.fragment"),o=Object.prototype.hasOwnProperty,i=e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,s={key:!0,ref:!0,__self:!0,__source:!0};function a(e,t,r){var a,c={},u=null,l=null;for(a in void 0!==r&&(u=""+r),void 0!==t.key&&(u=""+t.key),void 0!==t.ref&&(l=t.ref),t)o.call(t,a)&&!s.hasOwnProperty(a)&&(c[a]=t[a]);if(e&&e.defaultProps)for(a in t=e.defaultProps)void 0===c[a]&&(c[a]=t[a]);return{$$typeof:n,type:e,key:u,ref:l,props:c,_owner:i.current}}return y.Fragment=r,y.jsx=a,y.jsxs=a,y}():m.exports=x()),m.exports);const S=(e,t)=>{let n=null;return(...r)=>{null!=n&&clearTimeout(n),n=setTimeout(()=>e(...r),t)}},E=(e,t=50)=>{let n=0;return(...r)=>{let o=+new Date;o-n>t&&(n=o,e.apply(void 0,r))}};var M,L={exports:{}};const z=f((M||(M=1,function(e,t){function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=.3,o=.04,i=.11;window.addEventListener("touchmove",function(){});var s=function e(t){var s,u,l,h,p,d,f,v,m,y,g,w=t.source,b=void 0===w?document:w,x=t.update,_=t.multiplier,S=void 0===_?1:_,E=t.friction,M=void 0===E?.92:E,L=t.initialValues,z=t.boundX,k=t.boundY,C=t.bounce,P=void 0===C||C;n(this,e);var O=0,T=0,j=r*S,D=!1,R=!1,N=!1,Y=!1,$=[];function X(){document.removeEventListener("touchmove",W,!!c()&&{passive:!1}),document.removeEventListener("touchend",B),document.removeEventListener("touchcancel",q),document.removeEventListener("mousemove",W,!!c()&&{passive:!1}),document.removeEventListener("mouseup",B)}function F(){X(),document.addEventListener("touchmove",W,!!c()&&{passive:!1}),document.addEventListener("touchend",B),document.addEventListener("touchcancel",q),document.addEventListener("mousemove",W,!!c()&&{passive:!1}),document.addEventListener("mouseup",B)}function U(){x.call(b,O,T)}function I(e){if("touchmove"===e.type||"touchstart"===e.type||"touchend"===e.type){var t=e.targetTouches[0]||e.changedTouches[0];return{x:t.clientX,y:t.clientY,id:t.identifier}}return{x:e.clientX,y:e.clientY,id:null}}function A(e){var t=I(e);R||N||(R=!0,Y=!1,m=t.id,p=f=t.x,d=v=t.y,$=[],H(p,d),F())}function W(e){e.preventDefault();var t=I(e);R&&t.id===m&&(f=t.x,v=t.y,H(p,d),K())}function B(e){var t=I(e);R&&t.id===m&&q()}function q(){R=!1,H(p,d),G(),X()}function H(e,t){for(var n=Date.now();$.length>0&&!(n-$[0].time<=100);)$.shift();$.push({x:e,y:t,time:n})}function V(){var e=f-p,t=v-d;if(O+=e*S,T+=t*S,P){var n=J();0!==n.x&&(O-=e*Z(n.x)*S),0!==n.y&&(T-=t*Z(n.y)*S)}else J(!0);U(),p=f,d=v,D=!1}function Z(e){return 5e-6*Math.pow(e,2)+1e-4*e+.55}function K(){D||a(V),D=!0}function J(e){var t=0,n=0;return void 0!==s&&O<s?t=s-O:void 0!==u&&O>u&&(t=u-O),void 0!==l&&T<l?n=l-T:void 0!==h&&T>h&&(n=h-T),e&&(0!==t&&(O=t>0?s:u),0!==n&&(T=n>0?l:h)),{x:t,y:n,inBounds:0===t&&0===n}}function G(){var e=$[0],t=$[$.length-1],n=t.x-e.x,r=t.y-e.y,o=(t.time-e.time)/15/S;y=n/o||0,g=r/o||0;var i=J();(Math.abs(y)>1||Math.abs(g)>1||!i.inBounds)&&(Y=!0,a(Q))}function Q(){if(Y){O+=y*=M,T+=g*=M;var e=J();if(Math.abs(y)>j||Math.abs(g)>j||!e.inBounds){if(P){var t=2.5;if(0!==e.x)if(e.x*y<=0)y+=e.x*o;else{var n=e.x>0?t:-t;y=(e.x+n)*i}0!==e.y&&(e.y*g<=0?g+=e.y*o:(n=e.y>0?t:-t,g=(e.y+n)*i))}else 0!==e.x&&(O=e.x>0?s:u,y=0),0!==e.y&&(T=e.y>0?l:h,g=0);U(),a(Q)}else Y=!1}}!function(){if(!(b="string"==typeof b?document.querySelector(b):b))throw new Error("IMPETUS: source not found.");if(!x)throw new Error("IMPETUS: update function not defined.");L&&(L[0]&&(O=L[0]),L[1]&&(T=L[1]),U()),z&&(s=z[0],u=z[1]),k&&(l=k[0],h=k[1]),b.addEventListener("touchstart",A),b.addEventListener("mousedown",A)}(),this.destroy=function(){return b.removeEventListener("touchstart",A),b.removeEventListener("mousedown",A),X(),null},this.pause=function(){X(),R=!1,N=!0},this.resume=function(){N=!1},this.setValues=function(e,t){"number"==typeof e&&(O=e),"number"==typeof t&&(T=t)},this.setMultiplier=function(e){j=r*(S=e)},this.setBoundX=function(e){s=e[0],u=e[1]},this.setBoundY=function(e){l=e[0],h=e[1]}};t.exports=s;var a=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)};function c(){var e=!1;try{var t=Object.defineProperty({},"passive",{get:function(){e=!0}});window.addEventListener("test",null,t)}catch(n){}return c=function(){return e},e}}(0,L)),L.exports));var k,C,P,O,T,j;function D(){if(O)return P;O=1;var e=C?k:(C=1,k=function(e,t){t||(t=[0,""]),e=String(e);var n=parseFloat(e,10);return t[0]=n,t[1]=e.match(/[\d.\-\+]*\s*(.*)/)[1]||"",t});P=o;var t=r("in",document.body);function n(t,n){var r=e(getComputedStyle(t).getPropertyValue(n));return r[0]*o(r[1],t)}function r(e,t){var r=document.createElement("div");r.style.height="128"+e,t.appendChild(r);var o=n(r,"height")/128;return t.removeChild(r),o}function o(i,s){if(!i)return null;switch(s=s||document.body,i=(i+""||"px").trim().toLowerCase(),s!==window&&s!==document||(s=document.body),i){case"%":return s.clientHeight/100;case"ch":case"ex":return r(i,s);case"em":return n(s,"font-size");case"rem":return n(document.body,"font-size");case"vw":return window.innerWidth/100;case"vh":return window.innerHeight/100;case"vmin":return Math.min(window.innerWidth,window.innerHeight)/100;case"vmax":return Math.max(window.innerWidth,window.innerHeight)/100;case"in":return t;case"cm":return t/2.54;case"mm":return t/25.4;case"pt":return t/72;case"pc":return t/6;case"px":return 1}var a=e(i);if(!isNaN(a[0])&&a[1]){var c=o(a[1],s);return"number"==typeof c?a[0]*c:null}return null}return P}const R=f(function(){if(j)return T;j=1;var e=D();return T=function(t,n,r){"function"==typeof t&&(r=!!n,n=t,t=window);var o=e("ex",t),i=function(e){r&&e.preventDefault();var t=e.deltaX||0,i=e.deltaY||0,s=e.deltaZ||0,a=1;switch(e.deltaMode){case 1:a=o;break;case 2:a=window.innerHeight}if(i*=a,s*=a,(t*=a)||i||s)return n(t,i,s,e)};return t.addEventListener("wheel",i),i}}());var N,Y,$,X,F,U,I,A,W,B;function q(){if(X)return $;function e(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function t(e){return"function"==typeof e}function n(e){return"object"==typeof e&&null!==e}function r(e){return void 0===e}return X=1,$=e,e.EventEmitter=e,e.prototype._events=void 0,e.prototype._maxListeners=void 0,e.defaultMaxListeners=10,e.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},e.prototype.emit=function(e){var o,i,s,a,c,u;if(this._events||(this._events={}),"error"===e&&(!this._events.error||n(this._events.error)&&!this._events.error.length)){if((o=arguments[1])instanceof Error)throw o;var l=new Error('Uncaught, unspecified "error" event. ('+o+")");throw l.context=o,l}if(r(i=this._events[e]))return!1;if(t(i))switch(arguments.length){case 1:i.call(this);break;case 2:i.call(this,arguments[1]);break;case 3:i.call(this,arguments[1],arguments[2]);break;default:a=Array.prototype.slice.call(arguments,1),i.apply(this,a)}else if(n(i))for(a=Array.prototype.slice.call(arguments,1),s=(u=i.slice()).length,c=0;c<s;c++)u[c].apply(this,a);return!0},e.prototype.addListener=function(o,i){var s;if(!t(i))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",o,t(i.listener)?i.listener:i),this._events[o]?n(this._events[o])?this._events[o].push(i):this._events[o]=[this._events[o],i]:this._events[o]=i,n(this._events[o])&&!this._events[o].warned&&(s=r(this._maxListeners)?e.defaultMaxListeners:this._maxListeners)&&s>0&&this._events[o].length>s&&(this._events[o].warned=!0,console.trace),this},e.prototype.on=e.prototype.addListener,e.prototype.once=function(e,n){if(!t(n))throw TypeError("listener must be a function");var r=!1;function o(){this.removeListener(e,o),r||(r=!0,n.apply(this,arguments))}return o.listener=n,this.on(e,o),this},e.prototype.removeListener=function(e,r){var o,i,s,a;if(!t(r))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(s=(o=this._events[e]).length,i=-1,o===r||t(o.listener)&&o.listener===r)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,r);else if(n(o)){for(a=s;a-- >0;)if(o[a]===r||o[a].listener&&o[a].listener===r){i=a;break}if(i<0)return this;1===o.length?(o.length=0,delete this._events[e]):o.splice(i,1),this._events.removeListener&&this.emit("removeListener",e,r)}return this},e.prototype.removeAllListeners=function(e){var n,r;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(n in this._events)"removeListener"!==n&&this.removeAllListeners(n);return this.removeAllListeners("removeListener"),this._events={},this}if(t(r=this._events[e]))this.removeListener(e,r);else if(r)for(;r.length;)this.removeListener(e,r[r.length-1]);return delete this._events[e],this},e.prototype.listeners=function(e){return this._events&&this._events[e]?t(this._events[e])?[this._events[e]]:this._events[e].slice():[]},e.prototype.listenerCount=function(e){if(this._events){var n=this._events[e];if(t(n))return 1;if(n)return n.length}return 0},e.listenerCount=function(e,t){return e.listenerCount(t)},$}function H(){if(A)return I;A=1;var e={left:0,top:0};return I=function(t,n,r){n=n||t.currentTarget||t.srcElement,Array.isArray(r)||(r=[0,0]);var o=t.clientX||0,i=t.clientY||0,s=(a=n,a===window||a===document||a===document.body?e:a.getBoundingClientRect());var a;return r[0]=o-s.left,r[1]=i-s.top,r}}const V=f(function(){if(B)return W;B=1;var e=Y?N:(Y=1,N=function(e,t){var n=t[0]-e[0],r=t[1]-e[1];return Math.sqrt(n*n+r*r)}),t=q().EventEmitter,n=U?F:(U=1,F=function(e,t){return{configurable:!0,enumerable:!0,get:e,set:t}}),r=H();function o(){this.position=[0,0],this.touch=null}return W=function(i){i=i||window;var s=new t,a=[null,null],c=0,u=0,l=!1,h=!1;return Object.defineProperties(s,{pinching:n(function(){return 2===c}),fingers:n(function(){return a})}),d(),s.enable=d,s.disable=function(){if(!h)return;h=!1,c=0,a[0]=null,a[1]=null,u=0,l=!1,i.removeEventListener("touchstart",f,!1),i.removeEventListener("touchmove",v,!1),i.removeEventListener("touchend",m,!1),i.removeEventListener("touchcancel",m,!1)},s.indexOfTouch=p,s;function p(e){for(var t=e.identifier,n=0;n<a.length;n++)if(a[n]&&a[n].touch&&a[n].touch.identifier===t)return n;return-1}function d(){h||(h=!0,i.addEventListener("touchstart",f,!1),i.addEventListener("touchmove",v,!1),i.addEventListener("touchend",m,!1),i.addEventListener("touchcancel",m,!1))}function f(e){for(var t=0;t<e.changedTouches.length;t++){var n=e.changedTouches[t];if(-1===p(n.identifier)&&c<2){var h=0===c,d=a[0]?1:0,f=a[0]?0:1,v=new o;a[d]=v,c++,v.touch=n,r(n,i,v.position);var m=a[f]?a[f].touch:void 0;if(s.emit("place",n,m),!h){var g=y();l=!1,s.emit("start",g),u=g}}}}function v(e){for(var t=!1,n=0;n<e.changedTouches.length;n++){var o=e.changedTouches[n],l=p(o);-1!==l&&(t=!0,a[l].touch=o,r(o,i,a[l].position))}if(2===c&&t){var h=y();s.emit("change",h,u),u=h}}function m(e){for(var t=0;t<e.changedTouches.length;t++){var n=e.changedTouches[t],r=p(n);if(-1!==r){a[r]=null,c--;var o=0===r?1:0,i=a[o]?a[o].touch:void 0;s.emit("lift",n,i)}}l||2===c||(l=!0,s.emit("end"))}function y(){return c<2?0:e(a[0].position,a[1].position)}}}());var Z,K={exports:{}};const J=f(function(){if(Z)return K.exports;Z=1;var e=H(),t=q().EventEmitter;function n(n){var r=(n=n||{}).element||window,o=new t,i=n.position||[0,0];return!1!==n.touchstart&&(r.addEventListener("mousedown",a,!1),r.addEventListener("touchstart",s,!1)),r.addEventListener("mousemove",a,!1),r.addEventListener("touchmove",s,!1),o.position=i,o.dispose=function(){r.removeEventListener("mousemove",a,!1),r.removeEventListener("mousedown",a,!1),r.removeEventListener("touchmove",s,!1),r.removeEventListener("touchstart",s,!1)},o;function s(e){a(e.targetTouches[0])}function a(t){e(t,r,i),o.emit("move",t)}}return K.exports=function(e){return n(e).position},K.exports.emitter=function(e){return n(e)},K.exports}());function G(e){const{width:t,height:n,center:r,pan:o,size:i,padding:s}=e,a={width:Math.ceil(t/i+s),height:Math.ceil(n/i+s)},c=o?Math.ceil(o.x/i):0,h=o?Math.ceil(o.y/i):0,p={x:r.x-Math.ceil(a.width/2)+c,y:r.y+Math.ceil(a.height/2)-h},d={x:r.x+Math.ceil(a.width/2)+c,y:r.y-Math.ceil(a.height/2)-h},f=(d.x-p.x)*(p.y-d.y);return l(u({},a),{nw:p,se:d,area:f})}function Q(e){const{ctx:t,x:n,y:r,size:o,padding:i,border:s,color:a,image:c,left:u,top:l,right:h,bottom:p,scale:d,coords:f,parcels:v}=e,{codx:m,cody:y}=e,g=d?o*d:o,w=i/2;let b=n-g+w,x=r-g+w,_=g-i,S=g-i;l&&(x-=w,S+=w),u&&(b-=w,_+=w),h&&(_+=w+(g>80?.6:.5)),p&&(S+=w),s?(t.strokeStyle=s,t.lineWidth=i,t.strokeRect(b,x,_,S)):c&&g>30?t.drawImage(c,b,x,_,S):(a&&(t.fillStyle=a),t.fillRect(b,x,_,S));const E=new Path2D;E.rect(b,x,_,S),f.push(`${m},${y}`),v.push(E),g>70&&e.showCoord&&(t.fillStyle="#fff",t.fillText(`${m},${y}`,n-50,r-50))}function ee(e){const{ctx:t,width:n,height:r,size:o,pan:i,nw:s,se:a,center:c,layers:u,parcels:l,coords:h}=e;let p=n/2,d=r/2,f=o/16*.8;e.isLite?(p=n/2,d=r/2,f=o<7?.1:1,t.fillStyle=o<=4?"#fff":"#000",t.fillRect(0,0,n,r)):t.clearRect(0,0,n,r);a.x,s.x,s.y,a.y;for(const v of u)for(let n=s.x;n<a.x;n+=1)for(let r=a.y;r<s.y;r++){const s=(c.x-n)*o+(i?i.x:0),a=(r-c.y)*o+(i?i.y:0),u=v(n,r);if(!u)continue;const{color:m,top:y,left:g,right:w,bottom:b,scale:x,image:_,border:S}=u,E=x?o*x/2:o/2;Q({ctx:t,x:p-s+E,y:d-a+E,codx:n,cody:r,size:o,padding:f,color:m,border:S,image:_,left:g,top:y,right:w,bottom:b,scale:x,showCoord:e.showCoord,coords:h,parcels:l})}}class te extends d.PureComponent{constructor(e){super(e),h(this,"oldState"),h(this,"canvas"),h(this,"mounted"),h(this,"isMapMove"),h(this,"showCoord"),h(this,"hover"),h(this,"mouse"),h(this,"mouseDownPos"),h(this,"popupTimeout"),h(this,"mousedownTimestamp"),h(this,"coords"),h(this,"parcels"),h(this,"destroy"),h(this,"debouncedRenderMap",S(this.renderMap.bind(this),12)),h(this,"debouncedUpdateCenter",E(this.updateCenter.bind(this),0)),h(this,"debouncedHandleChange",E(this.handleChange.bind(this),0)),h(this,"handlePanZoom",e=>{if(!this.props.isDraggable)return;const{dx:t,dy:n,dz:r}=e,{size:o,maxSize:i,minSize:s,minX:a,maxX:c,minY:u,maxY:l,padding:h}=this.props,{pan:p,zoom:d}=this.state,f=i/o,v=s/o,m={x:p.x-t,y:p.y-n},y=Math.max(v,Math.min(f,d-r*this.getDzZoomModifier())),g=y*o;this.state.width,this.state.height;this.state.center.x,this.state.center.y,this.state.center.x,this.state.center.y,this.setState({pan:m,zoom:y,size:g},()=>{this.renderMap(),0===t&&0===n||this.debouncedUpdateCenter()})}),h(this,"handleClick",e=>{if(this.mouseDownPos){const t=Math.abs(e.offsetX-this.mouseDownPos.x),n=Math.abs(e.offsetY-this.mouseDownPos.y);if(t>5||n>5)return}let t;if(this.canvas){const n=this.canvas.getContext("2d");let r;for(let o=0;o<this.parcels.length;o++)r=this.parcels[o],n.isPointInPath(r,e.offsetX,e.offsetY)&&(t=this.coords[o].split(","))}if(t){const e=Number(t[0]),n=Number(t[1]),{onClick:r,onMouseUp:o}=this.props;r&&(r(e,n),this.renderMap()),o&&(o(e,n),this.renderMap())}}),h(this,"handleMouseUp",e=>{this.isMapMove=!1}),h(this,"handleMouseDown",e=>{this.mouseDownPos={x:e.offsetX,y:e.offsetY}}),h(this,"handleMouseMove",e=>{let t;if(this.canvas){const n=this.canvas.getContext("2d");let r;for(let o=0;o<this.parcels.length;o++)r=this.parcels[o],n.isPointInPath(r,e.offsetX,e.offsetY)&&(t=this.coords[o].split(","))}if(t){const n=Number(t[0]),r=Number(t[1]);if(!this.inBounds(n,r))return void this.hidePopup();this.props.onPopup&&this.props.onPopup({x:n,y:r,top:e.offsetY,left:e.offsetX,visible:!0}),this.hover&&this.hover.x===n&&this.hover.y===r||(this.hover={x:n,y:r})}}),h(this,"handleMouseOut",()=>{this.hidePopup()}),h(this,"refCanvas",e=>{this.canvas=e}),h(this,"handleTarget",()=>{const{x:e,y:t}=this.props;this.setState({center:{x:e,y:t}})});const{x:t,y:n,initialX:r,initialY:o,size:i,zoom:s,panX:a,panY:c}=e,u={pan:{x:a,y:c},center:{x:null==t?r:t,y:null==n?o:n},size:s*i,zoom:s,popup:null};this.state=this.generateState(e,u),this.oldState=this.state,this.hover=null,this.isMapMove=!1,this.mouse=null,this.mouseDownPos=null,this.mounted=!1,this.showCoord=!1,this.canvas=null,this.coords=[],this.parcels=[],this.popupTimeout=null}UNSAFE_componentWillUpdate(e,t){const{x:n,y:r}=this.props;n===e.x&&r===e.y||e.x===t.center.x&&e.y===t.center.y||(t=l(u({},t),{center:{x:e.x,y:e.y},pan:t.pan}));const o=this.generateState(e,t),i=o.width!==this.oldState.width||o.height!==this.oldState.height||o.nw.x!==this.oldState.nw.x||o.nw.y!==this.oldState.nw.y||o.se.x!==this.oldState.se.x||o.se.y!==this.oldState.se.y||o.zoom!==this.oldState.zoom;e.x===n&&e.y===r&&this.oldState&&!i||(this.oldState=o,this.setState(o,()=>{this.debouncedHandleChange()}))}UNSAFE_componentWillReceiveProps(e){const{zoom:t,maxSize:n,minSize:r,size:o}=e,i=n/o,s=r/o,a=Math.max(s,Math.min(i,t));a!==this.props.zoom&&a!==this.state.zoom&&this.setState({zoom:a,size:this.props.size*a})}componentDidUpdate(){this.debouncedRenderMap(),this.oldState=this.state}componentDidMount(){const{isDraggable:e}=this.props;localStorage&&(this.showCoord="coord"===localStorage.getItem("maxli")),this.renderMap(),this.canvas&&(e&&(this.destroy=function(e,t){const n=J.emitter({element:e});let r=0,o=0,i=!0;const s=()=>i=!0;e.addEventListener("mousedown",s),e.addEventListener("touchstart",s);let a=0,c=0;const u=new z({source:e,update:(s,u)=>{i&&(i=!1,r=n[0],o=n[1]);const l={target:e,type:"mouse",dx:s-c,dy:u-a,dz:0,x:n[0],y:n[1],x0:r,y0:o};c=s,a=u,t(l)},multiplier:1,friction:.75}),l=R(e,(r,o,i,s)=>{s.preventDefault(),t({target:e,type:"mouse",dx:0,dy:0,dz:o,x:n[0],y:n[1],x0:n[0],y0:n[1]})}),h=V(e);let p=null;return h.on("start",e=>{const[t,n]=h.fingers;p=[.5*n.position[0]+.5*t.position[0],.5*n.position[1]+.5*t.position[1]],u&&u.pause()}),h.on("end",()=>{p&&(p=null,u&&u.resume())}),h.on("change",(n,r)=>{h.pinching&&p&&t({target:e,type:"touch",dx:0,dy:0,dz:2*-(n-r),x:p[0],y:p[1],x0:p[0],y0:p[0]})}),function(){u.destroy(),n.dispose(),h.removeAllListeners(),e.removeEventListener("wheel",l),e.removeEventListener("mousedown",s),e.removeEventListener("touchstart",s)}}(this.canvas,this.handlePanZoom)),this.canvas.addEventListener("click",this.handleClick),this.canvas.addEventListener("mousedown",this.handleMouseDown),this.canvas.addEventListener("mousemove",this.handleMouseMove),this.canvas.addEventListener("mouseout",this.handleMouseOut)),this.mounted=!0}getPng(){return this.canvas?this.canvas.toDataURL("image/png"):""}componentWillUnmount(){this.destroy&&this.destroy(),this.canvas&&(this.canvas.removeEventListener("click",this.handleClick),this.canvas.removeEventListener("mousedown",this.handleMouseDown),this.canvas.removeEventListener("mousemove",this.handleMouseMove),this.canvas.removeEventListener("mouseout",this.handleMouseOut)),this.mounted=!1}generateState(e,t){const{width:n,height:r,padding:o}=e,{pan:i,zoom:s,center:a,size:c}=t,h=G({width:n,height:r,center:a,pan:i,size:c,padding:o});return l(u({},h),{pan:i,zoom:s,center:a,size:c})}handleChange(){const{onChange:e}=this.props,{nw:t,se:n,center:r,zoom:o}=this.state;this.mounted&&e&&e({nw:t,se:n,center:r,zoom:o})}getCanvasImageData(e,t){if(this.canvas){return this.canvas.getContext("2d").getImageData(e,t,1,1).data.join(",")}return""}mouseToCoords(e,t){const{padding:n}=this.props,{size:r,pan:o,center:i,width:s,height:a}=this.state,c=(e+o.x)/r,u=(t+o.y)/r,l=(s-n-.5)/2-i.x,h=(a-n-.5)/2+i.y;return[Math.round(c-l),Math.round(h-u)]}inBounds(e,t){const{minX:n,minY:r,maxX:o,maxY:i}=this.props;return e>=n&&e<=o&&t>=r&&t<=i}showPopup(e,t,n,r){const{onPopup:o,onHover:i}=this.props;o&&(this.hidePopup(),this.popupTimeout=+setTimeout(()=>{this.mounted&&this.setState({popup:{x:e,y:t,top:r,left:n,visible:!0}},()=>o(this.state.popup))},400)),i&&(i(e,t),this.renderMap())}hidePopup(){const{onPopup:e}=this.props;e&&(this.popupTimeout&&clearTimeout(this.popupTimeout),this.state.popup&&this.setState({popup:l(u({},this.state.popup),{visible:!1})},()=>{e(this.state.popup)}))}updateCenter(){const{pan:e,center:t,size:n}=this.state,r=e.x%n,o=e.y%n,i={x:r,y:o},s={x:t.x+Math.floor((e.x-r)/n),y:t.y-Math.floor((e.y-o)/n)};this.setState({pan:i,center:s})}renderMap(){if(!this.canvas)return;const{width:e,height:t,layers:n,renderMap:r}=this.props,{nw:o,se:i,pan:s,size:a,center:c}=this.state,u=this.canvas.getContext("2d");this.coords=[],this.parcels=[],r({ctx:u,width:e,height:t,size:a,pan:s,nw:o,se:i,center:c,coords:this.coords,showCoord:this.showCoord,parcels:this.parcels,layers:n})}getDz(){const{zoom:e}=this.state;return Math.sqrt(e)*(this.isMobile()?100:50)}getDzZoomModifier(){return this.isMobile(),.005}isMobile(){return this.props.width<768}getCanvasClassName(){const{isDraggable:e,onClick:t}=this.props;let n="kvm-tile-map-canvas";return e&&(n+=" draggable"),t&&(n+=" clickable"),n}render(){const{width:e,height:t,className:n}=this.props,r={width:e,height:t},o=("kvm-tile-map "+n).trim();return _.jsx("div",{className:o,style:r,children:_.jsx("canvas",{className:this.getCanvasClassName(),width:e,height:t,ref:this.refCanvas})})}}h(te,"defaultProps",{x:0,y:0,className:"",initialX:0,initialY:0,size:16,width:640,height:480,zoom:1,minSize:4,maxSize:40,minX:-250,maxX:250,minY:-250,maxY:250,panX:0,panY:0,padding:4,isDraggable:!0,renderMap:ee});class ne extends d.PureComponent{constructor(e){super(e),h(this,"oldState"),h(this,"canvas"),h(this,"showCoord"),h(this,"coords"),h(this,"parcels"),h(this,"destroy"),h(this,"refCanvas",e=>{this.canvas=e}),h(this,"handleTarget",()=>{const{x:e,y:t}=this.props;this.setState({center:{x:e,y:t}})});const{x:t,y:n,initialX:r,initialY:o,size:i,zoom:s,panX:a,panY:c}=e,u={pan:{x:a,y:c},center:{x:null==t?r:t,y:null==n?o:n},size:s*i,zoom:s,popup:null};this.state=this.generateState(e,u),this.oldState=this.state,this.showCoord=!1,this.canvas=null,this.coords=[],this.parcels=[]}UNSAFE_componentWillUpdate(e,t){const{x:n,y:r}=this.props;n===e.x&&r===e.y||e.x===t.center.x&&e.y===t.center.y||(t=l(u({},t),{center:{x:e.x,y:e.y},pan:{x:0,y:0}}));const o=this.generateState(e,t),i=o.width!==this.oldState.width||o.height!==this.oldState.height||o.nw.x!==this.oldState.nw.x||o.nw.y!==this.oldState.nw.y||o.se.x!==this.oldState.se.x||o.se.y!==this.oldState.se.y||o.zoom!==this.oldState.zoom;e.x===n&&e.y===r&&this.oldState&&!i||(this.oldState=o,this.setState(o,()=>{}))}componentDidUpdate(){this.renderMap(),this.oldState=this.state}componentDidMount(){this.renderMap()}getPng(){return this.canvas?this.canvas.toDataURL("image/png"):""}componentWillUnmount(){this.destroy&&this.destroy()}generateState(e,t){const{width:n,height:r,padding:o}=e,{pan:i,zoom:s,center:a,size:c}=t,h=G({width:n,height:r,center:a,pan:i,size:c,padding:o});return l(u({},h),{pan:i,zoom:s,center:a,size:c})}renderMap(){if(!this.canvas)return;const{width:e,height:t,layers:n,renderMap:r}=this.props,{nw:o,se:i,pan:s,size:a,center:c}=this.state,u=this.canvas.getContext("2d");this.coords=[],this.parcels=[],r({ctx:u,width:e,height:t,size:a,pan:s,nw:o,se:i,center:c,coords:this.coords,showCoord:this.showCoord,parcels:this.parcels,layers:n,isLite:!0});const{onRendered:l}=this.props;l&&l(this.getPng())}getDz(){const{zoom:e}=this.state;return Math.sqrt(e)*(this.isMobile()?100:50)}getDzZoomModifier(){return this.isMobile(),.005}isMobile(){return this.props.width<768}getCanvasClassName(){const{isDraggable:e,onClick:t}=this.props;let n="kvm-tile-map-canvas";return e&&(n+=" draggable"),t&&(n+=" clickable"),n}render(){const{width:e,height:t,className:n}=this.props,r={width:e,height:t},o=("kvm-tile-map "+n).trim();return _.jsx("div",{className:o,style:r,children:_.jsx("canvas",{className:this.getCanvasClassName(),width:e,height:t,ref:this.refCanvas})})}}h(ne,"defaultProps",{x:0,y:0,className:"",initialX:0,initialY:0,size:16,width:640,height:480,zoom:1,minSize:4,maxSize:40,minX:-50,maxX:50,minY:-50,maxY:50,panX:0,panY:0,padding:4,isDraggable:!0,renderMap:ee});e.Thing=({children:e})=>_.jsx("div",{children:e||"the snozzberries taste like snozzberries"}),e.TileMap=te,e.TileMapLite=ne,e.debounce=S,e.renderMap=ee,e.renderTile=Q,e.throttle=E,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});
